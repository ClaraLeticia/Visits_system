<h2>Registro de Usu√°rio</h2>
<form method="post" id="registrationForm">
    {% csrf_token %}
    {{ form.as_p }}

    <button type="submit">Registrar</button>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function toggleFields() {
            let atendente = document.getElementById("id_atendente").checked;
            let funcionario = document.getElementById("id_funcionario").checked;
            let branchField = document.getElementById("id_branch").parentElement;
            let departmentField = document.getElementById("id_department").parentElement;

            if (atendente || funcionario) {
                branchField.style.display = "block";
                departmentField.style.display = "block";
            } else {
                branchField.style.display = "none";
                departmentField.style.display = "none";
            }
        }

        function loadDepartments() {
            let branchId = document.getElementById("id_branch").value;
            let departmentSelect = document.getElementById("id_department");

            fetch(`/get-departments/?branch_id=${branchId}`)
                .then(response => response.json())
                .then(data => {
                    departmentSelect.innerHTML = '<option value="">Selecione um setor</option>';
                    data.departments.forEach(department => {
                        let option = new Option(department.name, department.id);
                        departmentSelect.add(option);
                    });
                })
                .catch(error => console.error("Erro ao carregar setores:", error));
        }

        document.getElementById("id_atendente").addEventListener("change", toggleFields);
        document.getElementById("id_funcionario").addEventListener("change", toggleFields);
        document.getElementById("id_branch").addEventListener("change", loadDepartments);
        toggleFields();
    });
</script>